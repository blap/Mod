"""\nDemonstration of the plugin system for the optimization framework.\n\nThis script demonstrates how to use the plugin system with practical examples.\n"""\n\nimport os\nimport tempfile\nfrom pathlib import Path\n\nfrom plugin_system import BasePlugin, PluginMetadata, PluginType, PluginState, PluginConfig, get_plugin_registry, get_lifecycle_manager, get_plugin_loader, get_config_manager, get_plugin_validator, get_plugin_tester\n    BasePlugin, PluginMetadata, PluginType, PluginState, PluginConfig,\n    get_plugin_registry, get_lifecycle_manager, get_plugin_loader,\n    get_config_manager, get_plugin_validator, get_plugin_tester\n)\n\n\nclass ExampleOptimizationPlugin(BasePlugin):\n    """\n    Example optimization plugin that demonstrates how to implement a plugin.\n    """\n    \n    def __init__(self):\n        metadata = PluginMetadata(\n            name="example_optimization_plugin",\n            version="1.0.0",\n            description="Example optimization plugin for demonstration",\n            author="Example Author",\n            plugin_type=PluginType.OPTIMIZATION,\n            dependencies=[],\n            compatibility=["1.0.0"],\n            config_schema={\n                "type": "object",\n                "properties": {\n                    "optimization_level": {\n                        "type": "integer",\n                        "default": 5,\n                        "minimum": 1,\n                        "maximum": 10\n                    },\n                    "enable_caching": {\n                        "type": "boolean",\n                        "default": True\n                    }\n                },\n                "required": ["optimization_level"]\n            }\n        )\n        super().__init__(metadata)\n        self.optimization_level = 5\n        self.enable_caching = True\n\n    def optimize(self, data, **kwargs):\n        """\n        Perform optimization on the provided data.\n        """\n        if self.state != PluginState.ACTIVE:\n            raise RuntimeError("Plugin must be active to perform optimization")\n        \n        # Apply optimization based on configuration\n        if self.enable_caching:\n            print(f"Using caching for optimization with level {self.optimization_level}")\n        \n        # Simulate optimization\n        optimized_data = f"optimized_{data}_level_{self.optimization_level}"\n        return optimized_data\n\n\nclass ExampleMemoryPlugin(BasePlugin):\n    """\n    Example memory management plugin.\n    """\n    \n    def __init__(self):\n        metadata = PluginMetadata(\n            name="example_memory_plugin",\n            version="1.0.0",\n            description="Example memory management plugin for demonstration",\n            author="Example Author",\n            plugin_type=PluginType.MEMORY_MANAGEMENT,\n            dependencies=["example_optimization_plugin"],  # Example dependency\n            compatibility=["1.0.0"]\n        )\n        super().__init__(metadata)\n        self.allocated_blocks = {}\n        self.next_block_id = 1\n\n    def allocate_memory(self, size: int, hints=None):\n        """\n        Allocate memory block of specified size.\n        """\n        if self.state != PluginState.ACTIVE:\n            raise RuntimeError("Plugin must be active to allocate memory")\n        \n        block_id = f"block_{self.next_block_id}"\n        self.allocated_blocks[block_id] = {\n            'size': size,\n            'allocated_at': __import__('time').time(),\n            'hints': hints or {}\n        }\n        self.next_block_id += 1\n        \n        print(f"Allocated memory block {block_id} of size {size}")\n        return block_id\n\n    def free_memory(self, memory_handle) -> bool:\n        """\n        Free the specified memory block.\n        """\n        if memory_handle in self.allocated_blocks:\n            del self.allocated_blocks[memory_handle]\n            print(f"Freed memory block {memory_handle}")\n            return True\n        return False\n\n\ndef demonstrate_plugin_system():\n    """\n    Demonstrate the plugin system functionality.\n    """\n    print("=== Plugin System Demonstration ===\n")\n    \n    # Get system components\n    registry = get_plugin_registry()\n    lifecycle_manager = get_lifecycle_manager()\n    loader = get_plugin_loader()\n    config_manager = get_config_manager()\n    validator = get_plugin_validator()\n    tester = get_plugin_tester()\n    \n    print("1. Creating example plugins...")\n    opt_plugin = ExampleOptimizationPlugin()\n    mem_plugin = ExampleMemoryPlugin()\n    \n    print("2. Registering plugins...")\n    registry.register_plugin(opt_plugin)\n    registry.register_plugin(mem_plugin)\n    \n    print("3. Initializing plugins...")\n    # Initialize with custom configurations\n    opt_config = PluginConfig("example_optimization_plugin", {\n        "optimization_level": 8,\n        "enable_caching": True\n    })\n    mem_config = PluginConfig("example_memory_plugin", {})\n    \n    opt_plugin.initialize(opt_config)\n    mem_plugin.initialize(mem_config)\n    \n    print("4. Validating plugins...")\n    opt_validation = validator.validate_plugin_by_name("example_optimization_plugin")\n    mem_validation = validator.validate_plugin_by_name("example_memory_plugin")\n    \n    print(f"   Optimization plugin validation: {'PASS' if opt_validation.is_valid else 'FAIL'}")\n    print(f"   Memory plugin validation: {'PASS' if mem_validation.is_valid else 'FAIL'}")\n    \n    print("5. Activating plugins...")\n    lifecycle_manager.activate_plugin("example_optimization_plugin")\n    lifecycle_manager.activate_plugin("example_memory_plugin")\n    \n    print("6. Using plugins...")\n    # Use the optimization plugin\n    result = opt_plugin.optimize("sample_data")\n    print(f"   Optimization result: {result}")\n    \n    # Use the memory plugin\n    block = mem_plugin.allocate_memory(1024, {"purpose": "test"})\n    print(f"   Allocated block: {block}")\n    mem_plugin.free_memory(block)\n    \n    print("7. Running plugin tests...")\n    opt_test_results = tester.run_plugin_tests("example_optimization_plugin")\n    mem_test_results = tester.run_plugin_tests("example_memory_plugin")\n    \n    print(f"   Optimization plugin tests: {len([t for t in opt_test_results if t.passed])}/{len(opt_test_results)} passed")\n    print(f"   Memory plugin tests: {len([t for t in mem_test_results if t.passed])}/{len(mem_test_results)} passed")\n    \n    print("8. Plugin configurations...")\n    all_configs = config_manager.get_all_plugin_configs()\n    for plugin_name, config in all_configs.items():\n        print(f"   {plugin_name}: {config}")\n    \n    print("9. Plugin registry status...")\n    all_plugins = registry.get_all_plugins()\n    print(f"   Total plugins in registry: {len(all_plugins)}")\n    \n    for plugin in all_plugins:\n        plugin_name = plugin.get_metadata().name\n        plugin_type = plugin.get_metadata().plugin_type.value\n        plugin_state = plugin.state.value\n        print(f"   - {plugin_name} ({plugin_type}): {plugin_state}")\n    \n    print("10. Deactivating and cleaning up...")\n    lifecycle_manager.deactivate_plugin("example_memory_plugin")\n    lifecycle_manager.deactivate_plugin("example_optimization_plugin")\n    \n    print("\n=== Plugin System Demonstration Complete ===")\n\n\ndef demonstrate_file_based_plugins():\n    """\n    Demonstrate loading plugins from files.\n    """\n    print("\n=== File-Based Plugin Demonstration ===\n")\n    \n    # Create a temporary plugin file\n    plugin_code = '''\nfrom .core import BasePlugin, PluginMetadata, PluginType, PluginState\n\nclass FileBasedPlugin(BasePlugin):\n    """A plugin loaded from a file."""\n\n    def __init__(self):\n        metadata = PluginMetadata(\n            name="file_based_plugin",\n            version="1.0.0",\n            description="Plugin loaded from file",\n            author="Demo",\n            plugin_type=PluginType.CUSTOM,\n            dependencies=[],\n            compatibility=["1.0.0"]\n        )\n        super().__init__(metadata)\n\n    def custom_function(self):\n        """A custom function for demonstration."""\n        if self.state != PluginState.ACTIVE:\n            raise RuntimeError("Plugin must be active")\n        return "Hello from file-based plugin!"\n'''\n    \n    with tempfile.NamedTemporaryFile(mode='w', suffix='.py', delete=False) as f:\n        f.write(plugin_code)\n        temp_plugin_file = f.name\n    \n    try:\n        # Get system components\n        loader = get_plugin_loader()\n        lifecycle_manager = get_lifecycle_manager()\n        registry = get_plugin_registry()\n        \n        print("1. Loading plugin from file...")\n        plugin_name = loader.load_plugin_from_file(temp_plugin_file)\n        print(f"   Loaded plugin: {plugin_name}")\n        \n        print("2. Initializing and activating...")\n        lifecycle_manager.initialize_all_plugins()\n        lifecycle_manager.activate_all_plugins()\n        \n        print("3. Using the loaded plugin...")\n        plugin = registry.get_plugin("file_based_plugin")\n        if plugin:\n            # Since our file-based plugin doesn't implement specific interfaces,\n            # we'll call a custom method if it exists\n            if hasattr(plugin, 'custom_function'):\n                result = plugin.custom_function()\n                print(f"   Custom function result: {result}")\n        \n        print("4. Deactivating and unloading...")\n        lifecycle_manager.deactivate_all_plugins()\n        lifecycle_manager.unload_all_plugins()\n        \n        print("   All plugins unloaded successfully")\n        \n    finally:\n        # Clean up the temporary file\n        os.unlink(temp_plugin_file)\n    \n    print("\n=== File-Based Plugin Demonstration Complete ===")\n\n\ndef main():\n    """\n    Main function to run all demonstrations.\n    """\n    try:\n        demonstrate_plugin_system()\n        demonstrate_file_based_plugins()\n        \n        print("\n=== All Demonstrations Complete ===")\n        print("The plugin system is now ready for use in your optimization framework!")\n        \n    except Exception as e:\n        print(f"Error during demonstration: {e}")\n        import traceback\n        traceback.print_exc()\n\n\nif __name__ == "__main__":\n    main()