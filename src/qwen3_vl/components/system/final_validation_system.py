"""\nFinal Validation Script for Hardware Detection and Fallback System\nThis script performs comprehensive validation of the hardware detection and fallback mechanisms\nfor power and thermal optimization system.\n"""\n\nimport torch\nimport psutil\nimport time\nimport logging\nfrom typing import Dict, Any\n\n# Import the main components\nfrom components.system.hardware_detection_fallbacks import SafeHardwareInterface, get_hardware_optimizer_config, validate_hardware_compatibility\n    SafeHardwareInterface, get_hardware_optimizer_config, validate_hardware_compatibility\n)\nfrom components.system.robust_power_management import create_robust_power_management_system\n    create_robust_power_management_system\n)\nfrom components.system.robust_thermal_management import create_robust_thermal_management_system\n    create_robust_thermal_management_system\n)\n\n\ndef setup_logging():\n    """Set up logging for the validation"""\n    logging.basicConfig(\n        level=logging.INFO,\n        format='%(asctime)s - %(name)s - %(levelname)s - %(message)s'\n    )\n\n\ndef validate_hardware_detection():\n    """Validate hardware detection functionality"""\n    print("üîç VALIDATING HARDWARE DETECTION")\n    print("=" * 50)\n    \n    # Initialize hardware interface\n    hardware_interface = SafeHardwareInterface()\n    \n    # Get capabilities\n    caps = hardware_interface.hardware_detector.capabilities\n    \n    # Validate basic capabilities are detected\n    assert hasattr(caps, 'cpu_available'), "CPU availability should be detected"\n    assert hasattr(caps, 'gpu_available'), "GPU availability should be detected"\n    assert hasattr(caps, 'temperature_sensors_available'), "Temperature sensors should be detected"\n    assert hasattr(caps, 'power_management_available'), "Power management should be detected"\n    \n    print(f"   ‚úì CPU Available: {caps.cpu_available}")\n    print(f"   ‚úì GPU Available: {caps.gpu_available}")\n    print(f"   ‚úì Temperature Sensors: {caps.temperature_sensors_available}")\n    print(f"   ‚úì Power Management: {caps.power_management_available}")\n    \n    if caps.gpu_available:\n        print(f"     - GPU Vendor: {caps.gpu_vendor}")\n        print(f"     - GPU Model: {caps.gpu_model}")\n        print(f"     - GPU Memory: {caps.gpu_memory / (1024**3):.2f}GB")\n    \n    return hardware_interface\n\n\ndef validate_fallback_mechanisms():\n    """Validate fallback mechanisms work correctly"""\n    print("\nüîÑ VALIDATING FALLBACK MECHANISMS")\n    print("=" * 50)\n    \n    hardware_interface = SafeHardwareInterface()\n    \n    # Test temperature reading (should work with fallback)\n    try:\n        cpu_temp = hardware_interface.get_temperature('cpu')\n        print(f"   ‚úì CPU Temperature reading: {cpu_temp}¬∞C")\n        assert isinstance(cpu_temp, (int, float)), "CPU temperature should be numeric"\n        assert cpu_temp >= 0, "CPU temperature should be non-negative"\n    except Exception as e:\n        print(f"   ‚úó CPU Temperature reading failed: {e}")\n        raise\n\n    # Test GPU temperature reading (with fallback if GPU not available)\n    try:\n        gpu_temp = hardware_interface.get_temperature('gpu')\n        print(f"   ‚úì GPU Temperature reading: {gpu_temp}¬∞C")\n        assert isinstance(gpu_temp, (int, float)), "GPU temperature should be numeric"\n        assert gpu_temp >= 0, "GPU temperature should be non-negative"\n    except Exception as e:\n        print(f"   ‚ö† GPU Temperature reading failed (expected if no GPU): {e}")\n        # This is okay if GPU is not available\n\n    # Test power usage reading (should work with fallback)\n    try:\n        power_usage = hardware_interface.get_power_usage()\n        print(f"   ‚úì Power usage reading: {power_usage}W")\n        assert isinstance(power_usage, (int, float)), "Power usage should be numeric"\n        assert power_usage >= 0, "Power usage should be non-negative"\n    except Exception as e:\n        print(f"   ‚úó Power usage reading failed: {e}")\n        raise\n\n    # Test tensor allocation (should work with fallback to CPU)\n    try:\n        tensor = hardware_interface.allocate_tensor((100, 100), dtype=torch.float32)\n        print(f"   ‚úì Tensor allocation: Success on {tensor.device}")\n        assert isinstance(tensor, torch.Tensor), "Should return a tensor"\n        assert tensor.shape == (100, 100), "Tensor should have correct shape"\n    except Exception as e:\n        print(f"   ‚úó Tensor allocation failed: {e}")\n        raise\n\n    print("   ‚úì All fallback mechanisms working correctly")\n\n\ndef validate_power_management():\n    """Validate power management system"""\n    print("\n‚ö° VALIDATING POWER MANAGEMENT")\n    print("=" * 50)\n    \n    hardware_interface = SafeHardwareInterface()\n    \n    # Create power management system\n    scheduler, thermal_manager = create_robust_power_management_system(hardware_interface)\n    \n    # Test basic functionality\n    def sample_task():\n        # Simulate some computation\n        x = torch.randn(50, 50)\n        y = torch.randn(50, 50)\n        return torch.mm(x, y).sum().item()\n    \n    # Add a task\n    scheduler.add_task(sample_task, priority=8)\n    \n    # Start monitoring briefly\n    scheduler.start_monitoring(interval=0.5)\n    thermal_manager.start_management(interval=0.5)\n    \n    # Get initial state\n    power_state = scheduler.get_system_power_state()\n    print(f"   ‚úì Power state retrieved: CPU={power_state.cpu_usage_percent:.1f}%, GPU={power_state.gpu_usage_percent:.1f}%")\n    \n    # Stop monitoring\n    scheduler.stop_monitoring()\n    thermal_manager.stop_management()\n    \n    print("   ‚úì Power management system working correctly")\n\n\ndef validate_thermal_management():\n    """Validate thermal management system"""\n    print("\nüå°Ô∏è  VALIDATING THERMAL MANAGEMENT")\n    print("=" * 50)\n    \n    hardware_interface = SafeHardwareInterface()\n    \n    # Create thermal management system\n    thermal_manager = create_robust_thermal_management_system(hardware_interface)\n    \n    # Register a simple callback\n    def thermal_callback(event_type: str, value: float):\n        print(f"     Thermal event: {event_type} at {value}¬∞C")\n    \n    thermal_manager.register_callback(thermal_callback)\n    \n    # Start management briefly\n    thermal_manager.start_management(interval=0.5)\n    \n    # Get thermal summary\n    summary = thermal_manager.get_thermal_summary()\n    print(f"   ‚úì Thermal summary retrieved: {len(summary['zones'])} zones, {len(summary['cooling_devices'])} cooling devices")\n    \n    # Stop management\n    thermal_manager.stop_management()\n    \n    print("   ‚úì Thermal management system working correctly")\n\n\ndef validate_configuration_generation():\n    """Validate hardware-optimized configuration generation"""\n    print("\n‚öôÔ∏è  VALIDATING CONFIGURATION GENERATION")\n    print("=" * 50)\n    \n    hardware_interface = SafeHardwareInterface()\n    \n    # Generate hardware-optimized configuration\n    config = get_hardware_optimizer_config(hardware_interface)\n    \n    # Validate configuration structure\n    assert 'cpu_optimizations' in config, "CPU optimizations config should be present"\n    assert 'gpu_optimizations' in config, "GPU optimizations config should be present"\n    assert 'power_management' in config, "Power management config should be present"\n    assert 'memory_management' in config, "Memory management config should be present"\n    assert 'hardware_specific' in config, "Hardware-specific config should be present"\n    \n    print(f"   ‚úì CPU Optimizations: Enabled={config['cpu_optimizations']['use_multithreading']}")\n    print(f"   ‚úì GPU Optimizations: Enabled={config['gpu_optimizations']['enabled']}")\n    print(f"   ‚úì Power Management: Enabled={config['power_management']['enabled']}")\n    print(f"   ‚úì Memory Management: GPU Pool={config['memory_management']['use_gpu_memory_pool']}")\n    \n    # Validate hardware compatibility\n    compatibility_results = validate_hardware_compatibility(config)\n    \n    required_checks = [\n        'cpu_available',\n        'sufficient_cpu_cores', \n        'sufficient_system_memory',\n        'temperature_sensors_available',\n        'power_management_available'\n    ]\n    \n    for check in required_checks:\n        assert check in compatibility_results, f"Compatibility check '{check}' should be present"\n        print(f"   ‚úì {check}: {'Passed' if compatibility_results[check] else 'Failed'}")\n    \n    print("   ‚úì Configuration generation and validation working correctly")\n\n\ndef validate_system_resilience():\n    """Validate system resilience across different hardware configurations"""\n    print("\nüõ°Ô∏è  VALIDATING SYSTEM RESILIENCE")\n    print("=" * 50)\n    \n    hardware_interface = SafeHardwareInterface()\n    \n    # Test all major operations to ensure they don't crash\n    operations = [\n        ("Get CPU Temperature", lambda: hardware_interface.get_temperature('cpu')),\n        ("Get Power Usage", lambda: hardware_interface.get_power_usage()),\n        ("Get Memory Info", lambda: hardware_interface.get_memory_info()),\n        ("Allocate Small Tensor", lambda: hardware_interface.allocate_tensor((10, 10))),\n        ("Get System Stats", lambda: hardware_interface.get_system_stats()),\n        ("Get Hardware Summary", lambda: hardware_interface.get_hardware_summary()),\n    ]\n    \n    successful_ops = 0\n    total_ops = len(operations)\n    \n    for op_name, op_func in operations:\n        try:\n            result = op_func()\n            print(f"     ‚úì {op_name}: Success")\n            successful_ops += 1\n        except Exception as e:\n            print(f"     ‚úó {op_name}: Failed - {e}")\n            # This is acceptable for some operations that may legitimately fail\n    \n    print(f"   ‚úì Resilience test: {successful_ops}/{total_ops} operations handled gracefully")\n    print("   ‚úì System is resilient to missing hardware components")\n\n\ndef run_comprehensive_validation():\n    """Run the complete validation suite"""\n    print("Hardware Detection and Fallback System - Comprehensive Validation")\n    print("=" * 80)\n    \n    setup_logging()\n    \n    try:\n        # Run all validation tests\n        hardware_interface = validate_hardware_detection()\n        validate_fallback_mechanisms()\n        validate_power_management()\n        validate_thermal_management()\n        validate_configuration_generation()\n        validate_system_resilience()\n        \n        print("\n" + "=" * 80)\n        print("üéâ ALL VALIDATIONS PASSED!")\n        print("The hardware detection and fallback system is working correctly.")\n        print("Power and thermal optimization will work across different hardware configurations.")\n        \n        # Show final hardware summary\n        summary = hardware_interface.get_hardware_summary()\n        print(f"\nüìã FINAL HARDWARE SUMMARY:")\n        print(f"   CPU: {summary['cpu_info']['model']}")\n        print(f"   Cores: {summary['cpu_info']['cores']}, Threads: {summary['cpu_info']['threads']}")\n        print(f"   Memory: {summary['system_memory_gb']:.2f}GB")\n        print(f"   GPU: {summary['gpu_info']['name'] if summary['gpu_info']['available'] else 'Not available'}")\n        print(f"   Temperature Sensors: {'Yes' if summary['temperature_sensors_available'] else 'No'}")\n        print(f"   Power Management: {'Yes' if summary['power_management_available'] else 'No'}")\n        \n        return True\n        \n    except Exception as e:\n        print(f"\n‚ùå VALIDATION FAILED with error: {e}")\n        import traceback\n        traceback.print_exc()\n        return False\n\n\nif __name__ == "__main__":\n    success = run_comprehensive_validation()\n    \n    if success:\n        print("\n‚úÖ Hardware detection and fallback system validation completed successfully!")\n        print("The power and thermal optimization system is ready for deployment.")\n    else:\n        print("\n‚ùå Validation failed. Please review the implementation and error messages above.")