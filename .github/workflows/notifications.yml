name: Notifications

on:
  workflow_run:
    workflows: ["CI", "Build", "Test", "Security Scan"]
    types: [completed]

jobs:
  notify:
    runs-on: ubuntu-latest
    if: ${{ github.event.workflow_run.conclusion == 'failure' }}
    
    steps:
    - name: Send failure notification
      uses: 8398a7/action-slack@v3
      with:
        status: ${{ job.status }}
        channel: '#ci-notifications'
        webhook_url: ${{ secrets.SLACK_WEBHOOK }}
        text: |
          âŒ Workflow failed: ${{ github.event.workflow.name }}
          ğŸ“ Commit: ${{ github.event.workflow_run.head_sha }}
          ğŸ‘¤ Author: ${{ github.event.workflow_run.head_commit.author.name }}
          ğŸ”— Link: ${{ github.event.workflow_run.html_url }}
          ğŸ·ï¸ Branch: ${{ github.event.workflow_run.head_branch }}
      env:
        SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK }}
        
  success-notify:
    runs-on: ubuntu-latest
    if: ${{ github.event.workflow_run.conclusion == 'success' && contains(github.event.workflow_run.head_branch, 'release') }}
    
    steps:
    - name: Send success notification for releases
      uses: 8398a7/action-slack@v3
      with:
        status: ${{ job.status }}
        channel: '#releases'
        webhook_url: ${{ secrets.SLACK_WEBHOOK }}
        text: |
          âœ… Release workflow succeeded: ${{ github.event.workflow.name }}
          ğŸ“ Commit: ${{ github.event.workflow_run.head_sha }}
          ğŸ·ï¸ Branch: ${{ github.event.workflow_run.head_branch }}
          ğŸ”— Link: ${{ github.event.workflow_run.html_url }}
      env:
        SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK }}