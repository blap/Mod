# Hardware Processor Plugins

## Overview

Inference-PIO utilizes a modular hardware plugin system to optimize execution for specific processor architectures. This allows the system to squeeze maximum performance out of diverse hardware configurations, from weak laptops to powerful workstations.

## Automatic Hardware Detection

The system includes an intelligent `HardwareAnalyzer` and a plugin factory that automatically detects your CPU and selects the optimal plugin. **No manual configuration is required** for supported processors.

### Supported Processors

The following processors have dedicated optimization plugins that are automatically selected:

1.  **Intel Core i5-7500 (Kaby Lake)**
    *   **Plugin:** `IntelKabyLakePlugin`
    *   **Optimizations:** 4-thread pinning, AVX2 vectorization, MKL backend tuning.
    *   **Target:** Desktop environments with modest multicore performance.

2.  **AMD Ryzen 7 5700 (Zen 3)**
    *   **Plugin:** `AmdRyzenPlugin`
    *   **Optimizations:** 8-core/16-thread management, Zen-specific AVX2 tuning, Hybrid execution support.
    *   **Target:** High-performance desktops. Automatically detects and utilizes discrete GPUs (like Radeon RX550) if drivers allow.

3.  **Intel Core i5-10210U (Comet Lake)**
    *   **Plugin:** `IntelCometLakePlugin`
    *   **Optimizations:** Power-aware threading, AVX2, Hybrid offloading for mobile GPUs (MX330).

### Generic Fallback

For processors without a dedicated plugin, the system falls back to the `GenericCPUPlugin`, which provides a robust, compatible execution environment using standard PyTorch operations.

## Architecture

### Factory Pattern

The selection logic is handled by `src.inference_pio.plugins.factory.get_processor_plugin`. It accepts a `SystemProfile` (generated by `HardwareAnalyzer`) and returns the appropriate `HardwareProcessorPluginInterface` implementation.

```python
from src.inference_pio.plugins import get_processor_plugin

# Automatically gets the right plugin for the current machine
plugin = get_processor_plugin()
plugin.initialize({})
```

### Adding New Plugins

To add support for a new processor:
1.  Create a new plugin class inheriting from `HardwareProcessorPluginInterface`.
2.  Implement optimized methods (`optimized_matmul`, etc.).
3.  Register it in `src/inference_pio/plugins/factory.py` with detection logic based on `cpu_brand`.

## Hybrid Execution

Plugins like `AmdRyzenPlugin` and `IntelCometLakePlugin` support **Hybrid Execution**. They can calculate an optimal split of model layers between the CPU and a weak GPU (like an RX550 or MX330) to maximize throughput when VRAM is limited.
